<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Shrine::Plugins::Derivatives::AttacherMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Shrine::Plugins::Derivatives::AttacherMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/shrine/plugins/derivatives_rb.html">lib/shrine/plugins/derivatives.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-add_derivative">add_derivative</a></li>
<li><a href="#method-i-add_derivatives">add_derivatives</a></li>
<li><a href="#method-i-change">change</a></li>
<li><a href="#method-i-create_derivatives">create_derivatives</a></li>
<li><a href="#method-i-data">data</a></li>
<li><a href="#method-i-delete_derivatives">delete_derivatives</a></li>
<li><a href="#attribute-i-derivatives">derivatives</a></li>
<li><a href="#method-i-derivatives-3D">derivatives=</a></li>
<li><a href="#method-i-destroy">destroy</a></li>
<li><a href="#method-i-get">get</a></li>
<li><a href="#method-i-get_derivatives">get_derivatives</a></li>
<li><a href="#method-i-load_data">load_data</a></li>
<li><a href="#method-i-map_derivative">map_derivative</a></li>
<li><a href="#method-i-merge_derivatives">merge_derivatives</a></li>
<li><a href="#method-i-process_derivatives">process_derivatives</a></li>
<li><a href="#method-i-promote">promote</a></li>
<li><a href="#method-i-promote_derivatives">promote_derivatives</a></li>
<li><a href="#method-i-remove_derivative">remove_derivative</a></li>
<li><a href="#method-i-remove_derivatives">remove_derivatives</a></li>
<li><a href="#method-i-set_derivatives">set_derivatives</a></li>
<li><a href="#method-i-upload_derivative">upload_derivative</a></li>
<li><a href="#method-i-upload_derivatives">upload_derivatives</a></li>
<li><a href="#method-i-url">url</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-derivatives'>derivatives</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span>
<span class='arguments'>(derivatives: {}, **options)</span>

</div>
<div class='description'>

<p>Adds the ability to accept derivatives.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'>   <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">92</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-value">derivatives:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">93</span>   <span class="ruby-keyword">super</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">94</span> &#x000A;<span class="line-num">95</span>   <span class="ruby-ivar">@derivatives</span>       = <span class="ruby-identifier">derivatives</span>&#x000A;<span class="line-num">96</span>   <span class="ruby-ivar">@derivatives_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>&#x000A;<span class="line-num">97</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-add_derivative'>
<a name='method-i-add_derivative'></a>
<div class='synopsis'>
<span class='name'>add_derivative</span>
<span class='arguments'>(name, file, **options)</span>

</div>
<div class='description'>

<p>Uploads a given file and adds it to the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>&#x000A;<span class="ruby-comment"># {</span>&#x000A;<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment"># }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivative</span>(<span class="ruby-value">:cropped</span>, <span class="ruby-identifier">cropped</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>&#x000A;<span class="ruby-comment"># {</span>&#x000A;<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment">#   cropped: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment"># }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">218</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_derivative</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">219</span>   <span class="ruby-identifier">add_derivatives</span>({ <span class="ruby-identifier">name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">file</span> }, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">220</span>   <span class="ruby-identifier">derivatives</span>[<span class="ruby-identifier">name</span>]&#x000A;<span class="line-num">221</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-add_derivatives'>
<a name='method-i-add_derivatives'></a>
<div class='synopsis'>
<span class='name'>add_derivatives</span>
<span class='arguments'>(files, **options)</span>

</div>
<div class='description'>

<p>Uploads given hash of files and adds uploaded files to the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>&#x000A;<span class="ruby-comment"># {</span>&#x000A;<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment"># }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>(<span class="ruby-value">cropped:</span> <span class="ruby-identifier">cropped</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt;</span>&#x000A;<span class="ruby-comment"># {</span>&#x000A;<span class="ruby-comment">#   thumb: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment">#   cropped: #&lt;Shrine::UploadedFile&gt;,</span>&#x000A;<span class="ruby-comment"># }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">200</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">201</span>   <span class="ruby-identifier">new_derivatives</span> = <span class="ruby-identifier">upload_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">202</span>   <span class="ruby-identifier">merge_derivatives</span>(<span class="ruby-identifier">new_derivatives</span>)&#x000A;<span class="line-num">203</span>   <span class="ruby-identifier">new_derivatives</span>&#x000A;<span class="line-num">204</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-change'>
<a name='method-i-change'></a>
<div class='synopsis'>
<span class='name'>change</span>
<span class='arguments'>(*args)</span>

</div>
<div class='description'>

<p>Clears derivatives when attachment changes.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">change</span>(<span class="ruby-identifier">file</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; {}</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-change-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-change-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">444</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">change</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;<span class="line-num">445</span>   <span class="ruby-identifier">result</span> = <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">446</span>   <span class="ruby-identifier">set_derivatives</span>({})&#x000A;<span class="line-num">447</span>   <span class="ruby-identifier">result</span>&#x000A;<span class="line-num">448</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_derivatives'>
<a name='method-i-create_derivatives'></a>
<div class='synopsis'>
<span class='name'>create_derivatives</span>
<span class='arguments'>(*args)</span>

</div>
<div class='description'>

<p>Calls processor and adds returned derivatives.</p>

<pre class="ruby"><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">derivatives_processor</span> <span class="ruby-value">:my_processor</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-comment"># ...</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">create_derivatives</span>(<span class="ruby-value">:my_processor</span>)</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">182</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;<span class="line-num">183</span>   <span class="ruby-identifier">files</span> = <span class="ruby-identifier">process_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;<span class="line-num">184</span>   <span class="ruby-identifier">add_derivatives</span>(<span class="ruby-identifier">files</span>)&#x000A;<span class="line-num">185</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-data'>
<a name='method-i-data'></a>
<div class='synopsis'>
<span class='name'>data</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Adds derivative data into the hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">attach</span>(<span class="ruby-identifier">io</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">data</span>&#x000A;<span class="ruby-comment">#=&gt;</span>&#x000A;<span class="ruby-comment"># {</span>&#x000A;<span class="ruby-comment">#   &quot;id&quot; =&gt; &quot;...&quot;,</span>&#x000A;<span class="ruby-comment">#   &quot;storage&quot; =&gt; &quot;store&quot;,</span>&#x000A;<span class="ruby-comment">#   &quot;metadata&quot; =&gt; { ... },</span>&#x000A;<span class="ruby-comment">#   &quot;derivatives&quot; =&gt; {</span>&#x000A;<span class="ruby-comment">#     &quot;thumb&quot; =&gt; {</span>&#x000A;<span class="ruby-comment">#       &quot;id&quot; =&gt; &quot;...&quot;,</span>&#x000A;<span class="ruby-comment">#       &quot;storage&quot; =&gt; &quot;store&quot;,</span>&#x000A;<span class="ruby-comment">#       &quot;metadata&quot; =&gt; { ... },</span>&#x000A;<span class="ruby-comment">#     }</span>&#x000A;<span class="ruby-comment">#   }</span>&#x000A;<span class="ruby-comment"># }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-data-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-data-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">398</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">data</span>&#x000A;<span class="line-num">399</span>   <span class="ruby-identifier">result</span> = <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">400</span> &#x000A;<span class="line-num">401</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">any?</span>&#x000A;<span class="line-num">402</span>     <span class="ruby-identifier">result</span> <span class="ruby-operator">||=</span> {}&#x000A;<span class="line-num">403</span>     <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;derivatives&quot;</span>] = <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-value">transform_keys:</span> <span class="ruby-value">:to_s</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">404</span>       <span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">data</span>&#x000A;<span class="line-num">405</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">406</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">407</span> &#x000A;<span class="line-num">408</span>   <span class="ruby-identifier">result</span>&#x000A;<span class="line-num">409</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-delete_derivatives'>
<a name='method-i-delete_derivatives'></a>
<div class='synopsis'>
<span class='name'>delete_derivatives</span>
<span class='arguments'>(derivatives = self.derivatives)</span>

</div>
<div class='description'>

<p>Deletes given hash of uploaded files.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">delete_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">uploaded_file</span>)&#x000A;<span class="ruby-identifier">uploaded_file</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-delete_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-delete_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">366</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_derivatives</span>(<span class="ruby-identifier">derivatives</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">derivatives</span>)&#x000A;<span class="line-num">367</span>   <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span> <span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">delete</span> }&#x000A;<span class="line-num">368</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-derivatives-3D'>
<a name='method-i-derivatives-3D'></a>
<div class='synopsis'>
<span class='name'>derivatives=</span>
<span class='arguments'>(derivatives)</span>

</div>
<div class='description'>

<p>Sets a hash of derivatives.</p>

<pre>attacher.derivatives = { thumb: Shrine.uploaded_file(...) }&#x000A;attacher.derivatives #=&gt; { thumb: #&lt;Shrine::UploadedFile ...&gt; }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-derivatives-3D-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-derivatives-3D-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">454</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">derivatives=</span>(<span class="ruby-identifier">derivatives</span>)&#x000A;<span class="line-num">455</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;<span class="line-num">456</span>     <span class="ruby-identifier">fail</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;expected derivatives to be a Hash, got #{derivatives.inspect}&quot;</span>&#x000A;<span class="line-num">457</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">458</span> &#x000A;<span class="line-num">459</span>   <span class="ruby-ivar">@derivatives</span> = <span class="ruby-identifier">derivatives</span>&#x000A;<span class="line-num">460</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-destroy'>
<a name='method-i-destroy'></a>
<div class='synopsis'>
<span class='name'>destroy</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>In addition to deleting the main file it also deletes any derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>].<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; true</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">destroy</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>].<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-destroy-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-destroy-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">170</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy</span>&#x000A;<span class="line-num">171</span>   <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">172</span>   <span class="ruby-identifier">delete_derivatives</span>&#x000A;<span class="line-num">173</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-get'>
<a name='method-i-get'></a>
<div class='synopsis'>
<span class='name'>get</span>
<span class='arguments'>(*path)</span>

</div>
<div class='description'>

<p>Convenience method for accessing derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span>&#x000A;<span class="ruby-comment"># can be shortened to</span>&#x000A;<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-get-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-get-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">104</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">105</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">106</span> &#x000A;<span class="line-num">107</span>   <span class="ruby-identifier">get_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">108</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-get_derivatives'>
<a name='method-i-get_derivatives'></a>
<div class='synopsis'>
<span class='name'>get_derivatives</span>
<span class='arguments'>(*path)</span>

</div>
<div class='description'>

<p>Convenience method for accessing derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-value">:thumbnails</span>, <span class="ruby-value">:large</span>)&#x000A;<span class="ruby-comment"># can be shortened to</span>&#x000A;<span class="ruby-identifier">photo</span>.<span class="ruby-identifier">image_derivatives</span>(<span class="ruby-value">:thumbnails</span>, <span class="ruby-value">:large</span>)</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-get_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-get_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">115</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">116</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">derivatives</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">117</span> &#x000A;<span class="line-num">118</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">119</span> &#x000A;<span class="line-num">120</span>   <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">121</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-load_data'>
<a name='method-i-load_data'></a>
<div class='synopsis'>
<span class='name'>load_data</span>
<span class='arguments'>(data)</span>

</div>
<div class='description'>

<p>Loads derivatives from data generated by <code>Attacher#data</code>.</p>

<pre>attacher.load_data({&#x000A;  &quot;id&quot; =&gt; &quot;...&quot;,&#x000A;  &quot;storage&quot; =&gt; &quot;store&quot;,&#x000A;  &quot;metadata&quot; =&gt; { ... },&#x000A;  &quot;derivatives&quot; =&gt; {&#x000A;    &quot;thumb&quot; =&gt; {&#x000A;      &quot;id&quot; =&gt; &quot;...&quot;,&#x000A;      &quot;storage&quot; =&gt; &quot;store&quot;,&#x000A;      &quot;metadata&quot; =&gt; { ... },&#x000A;    }&#x000A;  }&#x000A;})&#x000A;attacher.file        #=&gt; #&lt;Shrine::UploadedFile&gt;&#x000A;attacher.derivatives #=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-load_data-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-load_data-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">427</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_data</span>(<span class="ruby-identifier">data</span>)&#x000A;<span class="line-num">428</span>   <span class="ruby-identifier">data</span> <span class="ruby-operator">||=</span> {}&#x000A;<span class="line-num">429</span>   <span class="ruby-identifier">data</span>   = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">430</span> &#x000A;<span class="line-num">431</span>   <span class="ruby-identifier">derivatives_data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;derivatives&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:derivatives</span>) <span class="ruby-operator">||</span> {}&#x000A;<span class="line-num">432</span>   <span class="ruby-ivar">@derivatives</span>     = <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">derivatives</span>(<span class="ruby-identifier">derivatives_data</span>)&#x000A;<span class="line-num">433</span> &#x000A;<span class="line-num">434</span>   <span class="ruby-identifier">data</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">435</span> &#x000A;<span class="line-num">436</span>   <span class="ruby-keyword">super</span>(<span class="ruby-identifier">data</span>)&#x000A;<span class="line-num">437</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-map_derivative'>
<a name='method-i-map_derivative'></a>
<div class='synopsis'>
<span class='name'>map_derivative</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Iterates through nested derivatives and maps results.</p>

<pre>attacher.map_derivative(derivatives) { |path, file| ... }</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-map_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-map_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">465</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">map_derivative</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">466</span>   <span class="ruby-identifier">shrine_class</span>.<span class="ruby-identifier">map_derivative</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">467</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-merge_derivatives'>
<a name='method-i-merge_derivatives'></a>
<div class='synopsis'>
<span class='name'>merge_derivatives</span>
<span class='arguments'>(new_derivatives)</span>

</div>
<div class='description'>

<p>Deep merges given uploaded derivatives with current derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">merge_derivatives</span>(<span class="ruby-value">two:</span> <span class="ruby-identifier">uploaded_file</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-merge_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-merge_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">285</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_derivatives</span>(<span class="ruby-identifier">new_derivatives</span>)&#x000A;<span class="line-num">286</span>   <span class="ruby-ivar">@derivatives_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>&#x000A;<span class="line-num">287</span>     <span class="ruby-identifier">merged_derivatives</span> = <span class="ruby-identifier">deep_merge_derivatives</span>(<span class="ruby-identifier">derivatives</span>, <span class="ruby-identifier">new_derivatives</span>)&#x000A;<span class="line-num">288</span>     <span class="ruby-identifier">set_derivatives</span>(<span class="ruby-identifier">merged_derivatives</span>)&#x000A;<span class="line-num">289</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">290</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-process_derivatives'>
<a name='method-i-process_derivatives'></a>
<div class='synopsis'>
<span class='name'>process_derivatives</span>
<span class='arguments'>(processor_name = :default, source = nil, **options)</span>

</div>
<div class='description'>

<p>Downloads the attached file and calls the specified processor.</p>

<pre class="ruby"><span class="ruby-constant">Attacher</span>.<span class="ruby-identifier">derivatives_processor</span> <span class="ruby-value">:thumbnails</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">processor</span> = <span class="ruby-constant">ImageProcessing</span><span class="ruby-operator">::</span><span class="ruby-constant">MiniMagick</span>.<span class="ruby-identifier">source</span>(<span class="ruby-identifier">original</span>)&#x000A;&#x000A;  {&#x000A;    <span class="ruby-value">small:</span>  <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">300</span>, <span class="ruby-value">300</span>),&#x000A;    <span class="ruby-value">medium:</span> <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">500</span>, <span class="ruby-value">500</span>),&#x000A;    <span class="ruby-value">large:</span>  <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">resize_to_limit!</span>(<span class="ruby-value">800</span>, <span class="ruby-value">800</span>),&#x000A;  }&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">process_derivatives</span>(<span class="ruby-value">:thumbnails</span>)&#x000A;<span class="ruby-comment">#=&gt; { small: #&lt;File:...&gt;, medium: #&lt;File:...&gt;, large: #&lt;File:...&gt; }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-process_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-process_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">262</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_derivatives</span>(<span class="ruby-identifier">processor_name</span> = <span class="ruby-value">:default</span>, <span class="ruby-identifier">source</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">263</span>   <span class="ruby-comment"># handle receiving only source file without a processor</span>&#x000A;<span class="line-num">264</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">processor_name</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_sym</span>)&#x000A;<span class="line-num">265</span>     <span class="ruby-identifier">source</span>         = <span class="ruby-identifier">processor_name</span>&#x000A;<span class="line-num">266</span>     <span class="ruby-identifier">processor_name</span> = <span class="ruby-value">:default</span>&#x000A;<span class="line-num">267</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">268</span> &#x000A;<span class="line-num">269</span>   <span class="ruby-identifier">source</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">file!</span>&#x000A;<span class="line-num">270</span> &#x000A;<span class="line-num">271</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">UploadedFile</span>)&#x000A;<span class="line-num">272</span>     <span class="ruby-identifier">source</span>.<span class="ruby-identifier">download</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">273</span>       <span class="ruby-identifier">_process_derivatives</span>(<span class="ruby-identifier">processor_name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">274</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">275</span>   <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">276</span>     <span class="ruby-identifier">_process_derivatives</span>(<span class="ruby-identifier">processor_name</span>, <span class="ruby-identifier">source</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">277</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">278</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-promote'>
<a name='method-i-promote'></a>
<div class='synopsis'>
<span class='name'>promote</span>
<span class='arguments'>(**options)</span>

</div>
<div class='description'>

<p>In addition to promoting the main file, also promotes any cached derivatives. This is useful when these derivatives are being created as part of a direct upload.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">assign</span>(<span class="ruby-identifier">io</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivative</span>(<span class="ruby-value">:thumb</span>, <span class="ruby-identifier">file</span>, <span class="ruby-value">storage:</span> <span class="ruby-value">:cache</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">promote</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">stored?</span>(<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>[<span class="ruby-value">:thumb</span>]) <span class="ruby-comment">#=&gt; true</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-promote-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-promote-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">146</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">promote</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">147</span>   <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">148</span>   <span class="ruby-identifier">promote_derivatives</span>&#x000A;<span class="line-num">149</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-promote_derivatives'>
<a name='method-i-promote_derivatives'></a>
<div class='synopsis'>
<span class='name'>promote_derivatives</span>
<span class='arguments'>(**options)</span>

</div>
<div class='description'>

<p>Uploads any cached derivatives to permanent storage.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-promote_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-promote_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">152</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">promote_derivatives</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">153</span>   <span class="ruby-identifier">stored_derivatives</span> = <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">derivatives</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">derivative</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">154</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">cached?</span>(<span class="ruby-identifier">derivative</span>)&#x000A;<span class="line-num">155</span>       <span class="ruby-identifier">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">derivative</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">156</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">157</span>       <span class="ruby-identifier">derivative</span>&#x000A;<span class="line-num">158</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">159</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">160</span> &#x000A;<span class="line-num">161</span>   <span class="ruby-identifier">set_derivatives</span>(<span class="ruby-identifier">stored_derivatives</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">derivatives</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stored_derivatives</span>&#x000A;<span class="line-num">162</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-remove_derivative'>
<a name='method-i-remove_derivative'></a>
<div class='synopsis'>
<span class='name'>remove_derivative</span>
<span class='arguments'>(path, **options)</span>

</div>
<div class='description'>

<p>Removes derivative with specified name from the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivative</span>(<span class="ruby-value">:one</span>) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt; (removed derivative)</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { two: #&lt;Shrine::UploadedFile&gt; }</span></pre>

<p>Nested derivatives are also supported:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; } }</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivative</span>([<span class="ruby-value">:nested</span>, <span class="ruby-value">:one</span>]) <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt; (removed derivative)</span>&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt; } }</span></pre>

<p>The :delete option can be passed for deleting removed derivative:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;<span class="ruby-identifier">derivative</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>)&#x000A;<span class="ruby-identifier">derivative</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-remove_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-remove_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">358</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">359</span>   <span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>).<span class="ruby-identifier">first</span>&#x000A;<span class="line-num">360</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-remove_derivatives'>
<a name='method-i-remove_derivatives'></a>
<div class='synopsis'>
<span class='name'>remove_derivatives</span>
<span class='arguments'>(*paths, delete: false)</span>

</div>
<div class='description'>

<p>Removes derivatives with specified name from the derivatives hash.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>&#x000A;<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">:three</span>)&#x000A;<span class="ruby-comment">#=&gt; [#&lt;Shrine::UploadedFile&gt;, #&lt;Shrine::UploadedFile&gt;] (removed derivatives)</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>&#x000A;<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt; }</span></pre>

<p>Nested derivatives are also supported:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>&#x000A;<span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; } }</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>([<span class="ruby-value">:nested</span>, <span class="ruby-value">:two</span>], [<span class="ruby-value">:nested</span>, <span class="ruby-value">:three</span>])&#x000A;<span class="ruby-comment">#=&gt; [#&lt;Shrine::UploadedFile&gt;, #&lt;Shrine::UploadedFile&gt;] (removed derivatives)</span>&#x000A;&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>&#x000A;<span class="ruby-comment">#=&gt; { nested: { one: #&lt;Shrine::UploadedFile&gt; } }</span></pre>

<p>The :delete option can be passed for deleting removed derivatives:</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span>&#x000A;<span class="ruby-comment">#=&gt; { one: #&lt;Shrine::UploadedFile&gt;, two: #&lt;Shrine::UploadedFile&gt;, three: #&lt;Shrine::UploadedFile&gt; }</span>&#x000A;&#x000A;<span class="ruby-identifier">two</span>, <span class="ruby-identifier">three</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">remove_derivatives</span>(<span class="ruby-value">:two</span>, <span class="ruby-value">:three</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>)&#x000A;&#x000A;<span class="ruby-identifier">two</span>.<span class="ruby-identifier">exists?</span>   <span class="ruby-comment">#=&gt; false</span>&#x000A;<span class="ruby-identifier">three</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-comment">#=&gt; false</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-remove_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-remove_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">323</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_derivatives</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">paths</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">false</span>)&#x000A;<span class="line-num">324</span>   <span class="ruby-identifier">removed_derivatives</span> = <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">325</span>     <span class="ruby-identifier">path</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">326</span> &#x000A;<span class="line-num">327</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">one?</span>&#x000A;<span class="line-num">328</span>       <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">first</span>)&#x000A;<span class="line-num">329</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">330</span>       <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]).<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>[<span class="ruby-value">-1</span>])&#x000A;<span class="line-num">331</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">332</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">333</span> &#x000A;<span class="line-num">334</span>   <span class="ruby-identifier">set_derivatives</span> <span class="ruby-identifier">derivatives</span>&#x000A;<span class="line-num">335</span> &#x000A;<span class="line-num">336</span>   <span class="ruby-identifier">delete_derivatives</span>(<span class="ruby-identifier">removed_derivatives</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">delete</span>&#x000A;<span class="line-num">337</span> &#x000A;<span class="line-num">338</span>   <span class="ruby-identifier">removed_derivatives</span>&#x000A;<span class="line-num">339</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-set_derivatives'>
<a name='method-i-set_derivatives'></a>
<div class='synopsis'>
<span class='name'>set_derivatives</span>
<span class='arguments'>(derivatives)</span>

</div>
<div class='description'>

<p>Sets the given hash of uploaded files as derivatives.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">set_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">uploaded_file</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">derivatives</span> <span class="ruby-comment">#=&gt; { thumb: #&lt;Shrine::UploadedFile&gt; }</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-set_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-set_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">374</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_derivatives</span>(<span class="ruby-identifier">derivatives</span>)&#x000A;<span class="line-num">375</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">derivatives</span> = <span class="ruby-identifier">derivatives</span>&#x000A;<span class="line-num">376</span>   <span class="ruby-identifier">set</span> <span class="ruby-identifier">file</span> <span class="ruby-comment"># trigger model writing</span>&#x000A;<span class="line-num">377</span>   <span class="ruby-identifier">derivatives</span>&#x000A;<span class="line-num">378</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-upload_derivative'>
<a name='method-i-upload_derivative'></a>
<div class='synopsis'>
<span class='name'>upload_derivative</span>
<span class='arguments'>(path, file, storage: nil, **options)</span>

</div>
<div class='description'>

<p>Uploads the given file and deletes it afterwards.</p>

<pre class="ruby"><span class="ruby-identifier">hash</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">upload_derivative</span>(<span class="ruby-value">:thumb</span>, <span class="ruby-identifier">thumb</span>)&#x000A;<span class="ruby-identifier">hash</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-upload_derivative-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-upload_derivative-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">239</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span>, <span class="ruby-value">storage:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">240</span>   <span class="ruby-identifier">storage</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">derivative_storage</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">241</span> &#x000A;<span class="line-num">242</span>   <span class="ruby-identifier">file</span>.<span class="ruby-identifier">open</span>    <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Tempfile</span>)       <span class="ruby-comment"># refresh file descriptor</span>&#x000A;<span class="line-num">243</span>   <span class="ruby-identifier">file</span>.<span class="ruby-identifier">binmode</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:binmode</span>) <span class="ruby-comment"># ensure binary mode</span>&#x000A;<span class="line-num">244</span> &#x000A;<span class="line-num">245</span>   <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">storage</span>, <span class="ruby-value">derivative:</span> <span class="ruby-identifier">path</span>, <span class="ruby-value">delete:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">action:</span> <span class="ruby-value">:derivatives</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">246</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-upload_derivatives'>
<a name='method-i-upload_derivatives'></a>
<div class='synopsis'>
<span class='name'>upload_derivatives</span>
<span class='arguments'>(files, **options)</span>

</div>
<div class='description'>

<p>Uploads given hash of files.</p>

<pre class="ruby"><span class="ruby-identifier">hash</span> = <span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">upload_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span>)&#x000A;<span class="ruby-identifier">hash</span>[<span class="ruby-value">:thumb</span>] <span class="ruby-comment">#=&gt; #&lt;Shrine::UploadedFile&gt;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-upload_derivatives-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-upload_derivatives-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">227</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload_derivatives</span>(<span class="ruby-identifier">files</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">228</span>   <span class="ruby-identifier">map_derivative</span>(<span class="ruby-identifier">files</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">229</span>     <span class="ruby-identifier">path</span> = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">230</span> &#x000A;<span class="line-num">231</span>     <span class="ruby-identifier">upload_derivative</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">file</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">232</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">233</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-url'>
<a name='method-i-url'></a>
<div class='synopsis'>
<span class='name'>url</span>
<span class='arguments'>(*path, **options)</span>

</div>
<div class='description'>

<p>Allows generating a URL to the derivative by passing the derivative name.</p>

<pre class="ruby"><span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">add_derivatives</span>(<span class="ruby-value">thumb:</span> <span class="ruby-identifier">thumb</span>)&#x000A;<span class="ruby-identifier">attacher</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-comment">#=&gt; &quot;https://example.org/thumb.jpg&quot;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-url-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-url-source'>    <span class="ruby-comment"># File lib/shrine/plugins/derivatives.rb</span>&#x000A;<span class="line-num">128</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">url</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">129</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">130</span> &#x000A;<span class="line-num">131</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">derivative_path</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">132</span> &#x000A;<span class="line-num">133</span>   <span class="ruby-identifier">url</span>   = <span class="ruby-identifier">derivatives</span>.<span class="ruby-identifier">dig</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)&amp;.<span class="ruby-identifier">url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)&#x000A;<span class="line-num">134</span>   <span class="ruby-identifier">url</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">default_url</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">options</span>, <span class="ruby-value">derivative:</span> <span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">135</span>   <span class="ruby-identifier">url</span>&#x000A;<span class="line-num">136</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
