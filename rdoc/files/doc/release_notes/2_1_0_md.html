<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>2.1.0.md</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>2.1.0.md
</h1>
<div class='paths'>
doc/release_notes/2.1.0.md
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2021-05-20 21:03:17 +0200</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>â€”</p>

<h2 id="label-title-3A+Shrine+2.1.0">title: <a href="../../../classes/Shrine.html"><code>Shrine</code></a> <a href="2_1_0_md.html">2.1.0</a><span><a href="#label-title-3A+Shrine+2.1.0">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h1 id="label-Improvements">Improvements<span><a href="#label-Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The versions plugin doesn&#39;t require the <code>:names</code> option anymore.</p>
</li><li>
<p>The restore_cached_data plugin will now download only a small portion of the  file needed for extracting metadata (after which it will terminate the  connection). Previously the whole file was always downloaded. To get this  you need to update your storage gem.</p>
</li><li>
<p>When enforcing that the input is an IO-like object <a href="../../../classes/Shrine.html"><code>Shrine</code></a> doesn&#39;t check  method arity anymore, only if the object responds to that method. This means  that <a href="../../../classes/Shrine.html"><code>Shrine</code></a> now properly works with objects like <code>Rack::Test::UploadedFile</code>,  which use <code>#method_missing</code> to delegate to the underlying object.</p>
</li><li>
<p>Fixed a load order bug with parallelize and logging plugins, where loading  them in this order would make the thread pool join <em>outside</em> of the logging  block, making the logs show an instantaneous duration instead of the actual  duration.</p>
</li><li>
<p>The <code>file</code> command from the determine_mime_type plugin is now executed in the  same way for files as for other IO objects.</p>
</li><li>
<p>Increase the amount of bytes read from the IO in determine_mime_type when  using <code>:file</code> or <code>:filemagic</code> analyzers, which might make the recognize some  MIME types that they haven&#39;t before.</p>
</li></ul>

<h1 id="label-Backwards+compatibility">Backwards compatibility<span><a href="#label-Backwards+compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Generating versions in <code>:cache</code> phase is now deprecated, for better security.</p>
</li><li>
<p>The <code>#cached_&lt;attachment&gt;_data=</code> method that comes from the  cached_attachment_data plugin is now deprecated. The reason for this is that  the following "recommended" usage actually produces bugs when image is  invalid:</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">form_for</span> <span class="ruby-ivar">@photo</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">f</span>.<span class="ruby-identifier">hidden_field</span> <span class="ruby-value">:cached_image_data</span>&#x000A;  <span class="ruby-identifier">f</span>.<span class="ruby-identifier">file_filed</span> <span class="ruby-value">:image</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>The recommended and correct way now to build forms is by keeping the  <code>#&lt;attachment&gt;=</code> setter:</p>

<pre class="ruby"><span class="ruby-identifier">form_for</span> <span class="ruby-ivar">@photo</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">f</span>.<span class="ruby-identifier">hidden_field</span> <span class="ruby-value">:image</span>, <span class="ruby-value">value:</span> <span class="ruby-ivar">@photo</span>.<span class="ruby-identifier">cached_image_data</span>&#x000A;  <span class="ruby-identifier">f</span>.<span class="ruby-identifier">file_filed</span> <span class="ruby-value">:image</span>&#x000A;<span class="ruby-keyword">end</span></pre>
<ul><li>
<p>The restore_cached_data now sends the <code>Shrine::UploadedFile</code> to  <code>#extract_metadata</code>, instead of the result of <code>Storage#open</code>.</p>
</li><li>
<p>Storages which use <code>#stream</code> should switch to <code>Down.open</code> for remote files, or  the generic <code>Down::ChunkedIO</code> in other cases.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
