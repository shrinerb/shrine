<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>2.0.0.md</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>2.0.0.md
</h1>
<div class='paths'>
doc/release_notes/2.0.0.md
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2019-05-20 13:27:02 +0200</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Backwards+compatibility">Backwards compatibility<span><a href="#label-Backwards+compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Metadata and upload options are now differently passed to storages, so the  new signature of <code>#upload</code> and <code>#move</code> methods on the storage class should  be:</p>
</li></ul>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">upload</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-value">shrine_metadata:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">upload_options</span>)&#x000A;  <span class="ruby-comment"># ...</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">move</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">id</span>, <span class="ruby-value">shrine_metadata:</span> {}, <span class="ruby-operator">**</span><span class="ruby-identifier">upload_options</span>)&#x000A;  <span class="ruby-comment"># ...</span>&#x000A;<span class="ruby-keyword">end</span></pre>
<ul><li>
<p>The <code>Shrine::Confirm</code> functionality has been removed from storages&#39;  specification, storages should update <code>clear!</code> to remove the confirmation.</p>
</li><li>
<p>The <code>:delegate</code> option in migration_helpers now defaults to false.</p>
</li><li>
<p>The migration_helpers plugin has been deprecated, <code>Shrine::Attacher#cached?</code>  and <code>Shrine::Attacher#stored?</code> have been moved to base functionality.</p>
</li><li>
<p>The "background_helpers" alias for the backgrounding plugin has been  deprecated and will be removed in <a href="../../../classes/Shrine.html"><code>Shrine</code></a> 3.</p>
</li><li>
<p>In backgrounding plugin the "attachment" key has been renamed to  "name", and "uploaded_file" has been renamed to "attachment" in the data  hash in background job argument.</p>
</li><li>
<p><code>Shrine::Attacher.promote</code> and <code>Shrine::Attacher.delete</code> from backgrounding  plugin now return a <code>Shrine::Attacher</code> instance instead of the model  instance.</p>
</li><li>
<p>The moving plugin doesn&#39;t delete files that aren&#39;t movable anymore. You should  use delete_raw and/or delete_promoted plugins for this functionality.</p>
</li><li>
<p>The deprecated "delete_uploaded" alias for delete_raw plugin has been removed.</p>
</li><li>
<p>The deprecated "restore_cached" alias for restore_cached_data plugin has been  removed.</p>
</li><li>
<p>The deprecated keep_location plugin has been removed.</p>
</li><li>
<p>The deprecated <code>:subdirectory</code> option in FileSystem storage has been removed.</p>
</li><li>
<p>The deprecated <code>Shrine#default_url</code> has been removed (specifying a default  URL by overriding <code>#default_url</code> on the uploader), the default_url plugin  should be used instead.</p>
</li><li>
<p>The deprecated <code>Shrine.direct_endpoint</code> alias for <code>Shrine::UploadEndpoint</code>  in direct_upload plugin has been removed.</p>
</li><li>
<p>The <code>:presign</code> option in direct_upload plugin cannot be used for specifying  presign options anymore; <code>:presign_options</code> should be used instead.</p>
</li><li>
<p><code>Shrine::Attacher#set</code> and <code>#assign</code> methods don&#39;t return the assigned  uploaded file anymore.</p>
</li><li>
<p><code>Shrine::Attacher#delete!</code> doesn&#39;t spawn a background job anymore with  backgrounding plugin, plugin writers should switch to <code>#_delete</code> instead.</p>
</li><li>
<p>The phases when files are internally deleted have been renamed.</p>
</li><li>
<p><a href="../../../classes/Shrine.html"><code>Shrine</code></a> doesn&#39;t officially support Rubinius anymore.</p>
</li></ul>

<h1 id="label-New+plugins">New plugins<span><a href="#label-New+plugins">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The <a href="https://github.com/shrinerb/shrine-reform">shrine-reform</a> plugin has been released, which makes <a href="../../../classes/Shrine.html"><code>Shrine</code></a> attachments  work with <a href="https://github.com/apotonick/reform">Reform</a> objects.</p>
</li><li>
<p>The <a href="https://github.com/shrinerb/shrine-mongoid">shrine-mongoid</a> plugin has been released, which makes <a href="../../../classes/Shrine.html"><code>Shrine</code></a> attachments  work with <a href="https://github.com/mongodb/mongoid">Mongoid</a> models.</p>
</li></ul>

<h1 id="label-New+storages">New storages<span><a href="#label-New+storages">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The <a href="https://github.com/shrinerb/shrine-memory">shrine-memory</a> storage has been released, which saves uploaded files  in memory (useful in tests).</p>
</li></ul>

<h1 id="label-New+features">New features<span><a href="#label-New+features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The built-in analyzers can now be used when implementing a custom MIME type  analyzer in determine_mime_type plugin.</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:determine_mime_type</span>, <span class="ruby-value">analyzer:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">analyzers</span>) <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">analyzers</span>[<span class="ruby-value">:mimemagic</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">io</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">analyzers</span>[<span class="ruby-value">:file</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">io</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
<ul><li>
<p>The built-in analyzers can now be used when implementing a custom dimensions  analyzer in store_dimensions plugin.</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:store_dimensions</span>, <span class="ruby-value">analyzer:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">analyzers</span>) <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">dimensions</span> = <span class="ruby-identifier">analyzers</span>[<span class="ruby-value">:filemagic</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">io</span>)&#x000A;  <span class="ruby-identifier">dimensions</span> <span class="ruby-operator">||</span> <span class="ruby-constant">MiniMagick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>).<span class="ruby-identifier">dimensions</span>&#x000A;<span class="ruby-keyword">end</span></pre>
<ul><li>
<p><code>Shrine::Attacher#cache!</code>, <code>#store!</code> and <code>#delete!</code> are now public (they are  wrappers for <code>Shrine#upload</code> and <code>Shrine#delete</code> with context passed in).</p>
</li><li>
<p><code>Shrine::Attacher#_delete</code> has been added as a wrapper around <code>#delete!</code>,  which the backgrounding plugin overrides and makes aynchronous. This nicely  complements the <code>Shrine::Attacher#_promote</code> wrapper around <code>#promote</code>.</p>
</li></ul>

<h1 id="label-Other+improvements">Other improvements<span><a href="#label-Other+improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="../../../classes/Shrine.html"><code>Shrine</code></a> now prints a security warning when determine_mime_type plugin isn&#39;t  loaded.</p>
</li><li>
<p>Don&#39;t error in determine_mime_type with <code>:mimemagic</code> analyzer when MimeMagic  cannot determine MIME of the file.</p>
</li><li>
<p>When <code>:host</code> is given to S3 storage, URLs will now include the query  parameters, unless <code>:public</code> is given, just like without <code>:host</code>.</p>
</li><li>
<p>The Down version has been bumped to 2.2.0, which means the remote_url plugin  now follows redirects (maximum of 2 redirects by default).</p>
</li><li>
<p>The <code>Shrine::Attacher#_promote</code> and <code>Shrine::Attacher#promote</code> now have the  same generalized method signature.</p>
</li><li>
<p>The restore_cached_data plugin functionality won&#39;t get triggered anymore when  form is submitted with already saved cached attachmnet (e.g. due to  background processing).</p>
</li><li>
<p>The restore_cached_data plugin now doesn&#39;t check anymore if the cached file  exists (which saves an HTTP request with remote storages).</p>
</li><li>
<p>The download_endpoint now makes only one HTTP request when downloading files  from remote storages.</p>
</li><li>
<p>The activerecord plugin now allows attachment modules to be included in  non-ActiveRecord models.</p>
</li><li>
<p>The sequel plugin now allows attachment modules to be included in  non-Sequel models.</p>
</li><li>
<p>Plugin options are now persisted when reapplying plugins.</p>
</li></ul>

<pre class="ruby"><span class="ruby-constant">Shrine</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:download_endpoint</span>, <span class="ruby-value">storages:</span> [<span class="ruby-value">:store</span>], <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;/downloads&quot;</span>, <span class="ruby-value">disposition:</span> <span class="ruby-string">&quot;inline&quot;</span>&#x000A;&#x000A;<span class="ruby-keyword">class</span> <span class="ruby-constant">DocumentUploader</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Shrine</span>&#x000A;  <span class="ruby-comment"># all other options above will be persisted</span>&#x000A;  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:download_endpoint</span>, <span class="ruby-value">disposition:</span> <span class="ruby-string">&quot;attachment&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
<ul><li>
<p>The <code>:include_error</code> has been removed from remote_url plugin, the error will  now be included in the second argument depending on lambda&#39;s arity.</p>
</li><li>
<p>The dynamic_storage plugin doesn&#39;t cache the instantiated storages anymore,  which enables use cases like storing storage definitions in the database.</p>
</li><li>
<p>The determine_mime_type plugin with <code>:file</code> analyzer now handles filenames  that start with a dash ("-").</p>
</li><li>
<p><code>Shrine::Attacher</code> now allocates less strings.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
